import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as i,b as a,e as r,f as n,o as t}from"./app-sTD1ZwdD.js";const h="/assets/image-20241125101240437-DYDd3bL7.png",p="/assets/image-20241125123527273-C3Xh1WJ2.png",d="/assets/image-20241125123642046-BUKrGV8P.png",o="/assets/image-20241125123101958-BDEsL4_B.png",k={},Q={class:"MathJax",jax:"SVG",style:{position:"relative"}},T={style:{"vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.174ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1845 1000","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{position:"relative"}},m={style:{"vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.013ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 3541.7 1000","aria-hidden":"true"},A={class:"MathJax",jax:"SVG",style:{position:"relative"}},c={style:{"vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.74ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -683 769 705","aria-hidden":"true"},u={class:"MathJax",jax:"SVG",style:{position:"relative"}},y={style:{"vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"1.729ex",height:"1.538ex",role:"img",focusable:"false",viewBox:"0 -680 764 680","aria-hidden":"true"},B={class:"MathJax",jax:"SVG",style:{position:"relative"}},v={style:{"vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.294ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 572 453","aria-hidden":"true"},b={class:"MathJax",jax:"SVG",style:{position:"relative"}},f={style:{"vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.097ex",height:"1.027ex",role:"img",focusable:"false",viewBox:"0 -443 485 454","aria-hidden":"true"},F={class:"MathJax",jax:"SVG",style:{position:"relative"}},x={style:{"vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.158ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2279.7 1000","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{position:"relative"}},w={style:{"vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"1.729ex",height:"1.538ex",role:"img",focusable:"false",viewBox:"0 -680 764 680","aria-hidden":"true"},C={style:{"text-align":"center"}},H={class:"MathJax",jax:"SVG",style:{position:"relative"}},M={style:{"vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.409ex",height:"1.464ex",role:"img",focusable:"false",viewBox:"0 -442 1506.7 647","aria-hidden":"true"},L={class:"MathJax",jax:"SVG",style:{position:"relative"}},E={style:{"vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.354ex",height:"1.817ex",role:"img",focusable:"false",viewBox:"0 -598 5902.6 803","aria-hidden":"true"};function z(S,s){return t(),l("div",null,[s[37]||(s[37]=i("blockquote",null,[i("p",null,[i("strong",null,"èƒŒæ™¯å›é¡¾"),a("ï¼šæˆ‘ä»¬å·²ç»äº†è§£å¸¸è§çš„å¹¶å‘ bug ç±»å‹ï¼šæ­»é”ã€æ•°æ®ç«äº‰ã€åŸå­æ€§/é¡ºåºè¿åã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨ç¼–ç¨‹æ—¶æ¶ˆç­å¹¶å‘ bug ä»ç„¶æ˜¯ä¸€ä¸ªä¸–ç•Œæ€§çš„éš¾é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹è¿™äº›å¹¶å‘ bugsï¼Ÿ")])],-1)),s[38]||(s[38]=i("p",null,[i("strong",null,"æœ¬è®²å†…å®¹"),a("ï¼š"),i("strong",null,"å¦ä¸€èŠ‚çœŸæ­£çš„å®ç”¨ â€œç¼–ç¨‹â€ è¯¾"),a(" â€”â€” å¦‚ä½•æ­£ç¡®åœ° (å¹¶å‘) ç¼–ç¨‹ï¼šåº”å¯¹ä¸‰ç§å¸¸è§çš„ â€œæ­»äº¡â€ æ–¹å¼ï¼š")],-1)),s[39]||(s[39]=i("ul",null,[i("li",null,"æ­»é” (deadlock)"),i("li",null,"æ­»å±€ (è½¯ä»¶å±æœºä¸­çš„ dead end)"),i("li",null,"æ­»çº¿ (deadline)")],-1)),r(" more -"),s[40]||(s[40]=n('<h2 id="åº”å¯¹æ­»é”" tabindex="-1"><a class="header-anchor" href="#åº”å¯¹æ­»é”"><span>åº”å¯¹æ­»é”</span></a></h2><p>æ­»é”å…¶å®æ˜¯ä¸€ç±»æ¯”è¾ƒ &quot;å®¹æ˜“&quot; ä¸” &quot;æ˜ç¡®&quot; çš„å¹¶å‘ bug :</p><ul><li>å®ƒå®¹æ˜“è¢«è§‚æµ‹</li><li>é’ˆå¯¹é¿å…è¯¥ bug çš„æ­£ç¡®æ€§å…·æœ‰æ˜ç¡®çš„æ ‡å‡†ï¼š <ul><li>ä»»ä½•çº¿ç¨‹åœ¨ â€œåŸºæœ¬åˆç†â€ çš„è°ƒåº¦ä¸‹ï¼Œä¸èƒ½å¤±å»è¿›å±•</li></ul></li><li>å®ƒç”šè‡³æœ‰æ˜ç¡®çš„å¿…è¦æ¡ä»¶ <ul><li>Mutual-exclusion - ä¸€ä¸ªå£è¢‹ä¸€ä¸ªçƒï¼Œå¾—åˆ°çƒæ‰èƒ½ç»§ç»­</li><li>Wait-for - å¾—åˆ°çƒçš„äººæƒ³è¦æ›´å¤šçš„çƒ</li><li>No-preemption - ä¸èƒ½æŠ¢åˆ«äººçš„æŒæœ‰çš„çƒ</li><li>Circular-chain - å½¢æˆå¾ªç¯ç­‰å¾…çƒçš„å…³ç³» (ç›¸å¯¹å®¹æ˜“ç ´åçš„æ¡ä»¶)</li></ul></li><li>...</li></ul><p>ä¸ºäº†é¿å…æ­»é”ï¼Œæˆ‘ä»¬åœ¨ä¸ŠèŠ‚è¯¾ä¹Ÿæåˆ°äº†å¯ä»¥é‡‡ç”¨ <em><strong>Lock Ordering</strong></em> çš„æ–¹å¼æ¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œã€‚</p><p>å¯¹ <em><strong>Lock Ordering</strong></em> çš„ä¸€ä¸ªå…¸å‹åº”ç”¨å°±æ˜¯ Linux ä¸­çš„ <code>mm/rmap.c</code>ï¼š</p><figure><img src="'+h+'" alt="mm/rmap.c" tabindex="0" loading="lazy"><figcaption>mm/rmap.c</figcaption></figure><p>ä½ ä¼šå‘ç°ï¼Œä¸ºäº†è¿½æ±‚æ€§èƒ½ä¸ç¨‹åºæ­£ç¡®æ€§ä¹‹é—´çš„å¹³è¡¡ï¼Œæˆ‘ä»¬ä¼¼ä¹æ­£åœ¨èµ°å…¥ä¸€ä¸ªæ­»å±€ï¼š</p><p><strong>ä¸€é¢æ˜¯å¤æ‚çš„ç³»ç»Ÿï¼Œå¦ä¸€é¢æ˜¯ä¸å¯é çš„äºº</strong></p><ul><li>æˆ‘ä»¬å¸Œæœ›çš„ <ul><li>æ ‡è®° â€œåšä¸€ä»¶äº‹â€ ä¸è¢«æ‰“æ–­</li></ul></li><li>å®é™…éœ€è¦åšçš„ <ul><li>â€œåšä¸€ä»¶äº‹â€ éœ€è¦æ‹†è§£æˆå¤šä¸ªæ­¥éª¤</li><li>æ¯ä¸ªæ­¥éª¤éœ€è¦ä¸Šæ­£ç¡® (è€Œä¸”å°½å¯èƒ½å°‘) çš„é”</li><li>â†‘ ä¸ºäº†ç¨‹åºçš„é«˜æ€§èƒ½ï¼Œæˆ‘ä»¬å¸¦æ¥äº†è¯¸å¤šå¤æ‚æ€§...è¿™äº›å¤æ‚æ€§ä½¿å¾—æˆ‘ä»¬ç¨‹åºçš„æ­£ç¡®æ€§æ›´åŠ éš¾ä»¥éªŒè¯</li></ul></li></ul><h2 id="åº”å¯¹æ­»å±€-â€”â€”-ç»å¤„é€¢ç”Ÿ" tabindex="-1"><a class="header-anchor" href="#åº”å¯¹æ­»å±€-â€”â€”-ç»å¤„é€¢ç”Ÿ"><span>åº”å¯¹æ­»å±€ â€”â€” ç»å¤„é€¢ç”Ÿ</span></a></h2><p>åº”å¯¹ä¸Šè¿°æ­£ç¡®æ€§çš„æ­»å±€ï¼Œç¨‹åºå‘˜ä»¬æƒ³åˆ°äº†ä¸€ä¸ªèƒ½å¤Ÿè‡ªæ•‘çš„åŠæ³•ï¼š</p><p>åœ¨ <strong>è¿è¡Œæ—¶</strong> æ£€æŸ¥ bugs çš„ <strong>Specifications</strong> å°±å¯ä»¥äº†ï¼š</p><ul><li>AA/ABBA å‹æ­»é”</li><li>æ•°æ®ç«äº‰</li><li>å¸¦ç¬¦å·æ•´æ•°æº¢å‡º (undefined behavior)</li><li>Use after free</li><li>â€¦â€¦</li></ul><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œä¹Ÿä¼šä½¿ç”¨å„ç§æ–¹å¼ (åŒ…æ‹¬ä½†ä¸é™äº <code>printf</code>ã€ <code>display</code> ã€ <code>bt</code> ç­‰) æŸ¥çœ‹çŠ¶æ€æœºå†…éƒ¨çš„ä¸€äº›ä¿¡æ¯æˆ–è€…è°ƒç”¨å †æ ˆç­‰ç­‰ã€‚</p><p>å½’æ ¹ç»“åº•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è¿™äº›æ–¹å¼è°ƒè¯•çš„æ—¶å€™éƒ½æ˜¯æƒ³çŸ¥é“çŠ¶æ€æœºåœ¨å“ªå‡ æ­¥å¯èƒ½å‡ºç°äº†é—®é¢˜ â€”â€” æˆ‘ä»¬åœ¨è§‚æµ‹çŠ¶æ€æœºæŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä¸å†å²çš„çŠ¶æ€è½¨è¿¹ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº† <strong>åŠ¨æ€ç¨‹åºåˆ†æ</strong> è¿™ä¸€ &quot;è‡ªåŠ¨åŒ–&quot; è‡ªæ•‘æ–¹æ³•ï¼š</p>',16)),i("p",null,[s[2]||(s[2]=a("(æ¯æ¬¡çŠ¶æ€è¿ç§»æ—¶ï¼Œ) è°ƒç”¨ä»¥ ")),s[3]||(s[3]=i("strong",null,"çŠ¶æ€æœºæ‰§è¡Œå†å²",-1)),s[4]||(s[4]=a(" ä¸ºè¾“å…¥çš„åˆ†æå‡½æ•° ")),i("mjx-container",Q,[(t(),l("svg",T,s[0]||(s[0]=[n('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939,0)"><path data-c="1D70F" d="M39 284Q18 284 18 294Q18 301 45 338T99 398Q134 425 164 429Q170 431 332 431Q492 431 497 429Q517 424 517 402Q517 388 508 376T485 360Q479 358 389 358T299 356Q298 355 283 274T251 109T233 20Q228 5 215 -4T186 -13Q153 -13 153 20V30L203 192Q214 228 227 272T248 336L254 357Q254 358 208 358Q206 358 197 358T183 359Q105 359 61 295Q56 287 53 286T39 284Z"></path></g><g data-mml-node="mo" transform="translate(1456,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g>',1)]))),s[1]||(s[1]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"f"),i("mo",{stretchy:"false"},"("),i("mi",null,"Ï„"),i("mo",{stretchy:"false"},")")])],-1))]),s[5]||(s[5]=a(" æ¥æ£€æŸ¥ bugs å¯¹åº”çš„ ")),s[6]||(s[6]=i("strong",null,"Specifications",-1)),s[7]||(s[7]=a(" ï¼š"))]),s[41]||(s[41]=i("ul",null,[i("li",null,"è™½ç„¶è¦ä»˜å‡ºç¨‹åºæ‰§è¡Œå˜æ…¢çš„ä»£ä»·"),i("li",null,"ä½†æ˜¯å¯ä»¥å¸®æˆ‘ä»¬æ‰¾åˆ°æ›´å¤š bugs")],-1)),s[42]||(s[42]=i("h3",{id:"è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥"},[i("span",null,"è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥")])],-1)),s[43]||(s[43]=i("p",null,[a('ç”±äº "AA" å‹æ­»é”æˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»ä¼¼äº '),i("em",null,"xv6"),a(' ä¸­çš„é˜²å¾¡æ€§ç¼–ç¨‹æ¥å®ç°æ£€æŸ¥ï¼Œé‚£ä¹ˆå‰©ä¸‹éœ€è¦æ£€æŸ¥çš„æ­»é”ä»…ä¸º "ABBA" å‹ã€‚')],-1)),s[44]||(s[44]=i("p",null,[a('"ABBA" å‹æ­»é”çš„é”è·å–é¡ºåº '),i("strong",null,"åœ¨å›¾çš„æ„ä¹‰ä¸Šæ˜¯ä¸ªç¯"),a("ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ä¸€ä¸ªæƒ³æ³•ï¼š")],-1)),i("ul",null,[s[30]||(s[30]=i("li",null,[a("ä¸ºæ¯ä¸€ä¸ª "),i("em",null,"acquire"),a(" / "),i("em",null,"release"),a(" è®°å½• "),i("code",null,"tid"),a(" å’Œ "),i("code",null,"lock_name"),a(" (è®°å½•çº¿ç¨‹ä¸Šé”/è§£é”çš„ä¿¡æ¯)")],-1)),i("li",null,[s[28]||(s[28]=a("Assert: ")),i("mjx-container",g,[(t(),l("svg",m,s[8]||(s[8]=[n('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mo" transform="translate(786,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1175,0)"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></g><g data-mml-node="mo" transform="translate(1944,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2388.7,0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mo" transform="translate(3152.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g>',1)]))),s[9]||(s[9]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"G"),i("mo",{stretchy:"false"},"("),i("mi",null,"V"),i("mo",null,","),i("mi",null,"E"),i("mo",{stretchy:"false"},")")])],-1))]),s[29]||(s[29]=a(" æ— æˆç¯ ")),i("ul",null,[i("li",null,[i("mjx-container",A,[(t(),l("svg",c,s[10]||(s[10]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D449",d:"M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"})])])],-1)]))),s[11]||(s[11]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"V")])],-1))]),s[12]||(s[12]=a(": æ‰€æœ‰çš„ ")),s[13]||(s[13]=i("code",null,"lock_name",-1))]),i("li",null,[i("mjx-container",u,[(t(),l("svg",y,s[14]||(s[14]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D438",d:"M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"})])])],-1)]))),s[15]||(s[15]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"E")])],-1))]),s[24]||(s[24]=a(": æ¯å½“è§‚æµ‹åˆ°æŒæœ‰ ")),i("mjx-container",B,[(t(),l("svg",v,s[16]||(s[16]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D462",d:"M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"})])])],-1)]))),s[17]||(s[17]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"u")])],-1))]),s[25]||(s[25]=a(" æ—¶è·å– ")),i("mjx-container",b,[(t(),l("svg",f,s[18]||(s[18]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D463",d:"M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"})])])],-1)]))),s[19]||(s[19]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"v")])],-1))]),s[26]||(s[26]=a(" å°±æŠŠ ")),i("mjx-container",F,[(t(),l("svg",x,s[20]||(s[20]=[n('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(961,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(1405.7,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mo" transform="translate(1890.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g>',1)]))),s[21]||(s[21]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mo",{stretchy:"false"},"("),i("mi",null,"u"),i("mo",null,","),i("mi",null,"v"),i("mo",{stretchy:"false"},")")])],-1))]),s[27]||(s[27]=a(" åŠ å…¥ ")),i("mjx-container",D,[(t(),l("svg",w,s[22]||(s[22]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D438",d:"M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"})])])],-1)]))),s[23]||(s[23]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"E")])],-1))])])])])]),s[45]||(s[45]=n(`<div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="è®°å½•çº¿ç¨‹ä¸Šé”/è§£é”ä¿¡æ¯" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T1 ACQ a</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T1 ACQ b</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T1 REL b</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T2 ACQ b</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T2 REL b</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£æˆ‘ä»¬åªéœ€è¦åŠ¨æ€ç»´æŠ¤é”çš„æŒæœ‰å›¾ï¼Œå¹¶ä¸”æ—¶åˆ»æ£€æŸ¥é”æŒæœ‰å›¾ä¸­ <strong>æ˜¯å¦å­˜åœ¨ç¯</strong>ï¼Œå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬çš„ <strong>è¿è¡Œæ—¶æ­»é”æ£€æŸ¥ç¨‹åº</strong>ï¼</p><div class="hint-container info"><p class="hint-container-title">å¦‚æœæƒ³è¦æ›´é«˜æ•ˆä¸€äº›å‘¢?</p><ul><li>çœŸçš„éœ€è¦æ—¶åˆ»åŠ¨æ€ç»´æŠ¤ç»“ç‚¹å—ï¼Ÿ</li><li>çœŸçš„éœ€è¦æ—¶åˆ»æ£€æŸ¥å›¾ä¸­æ˜¯å¦æˆç¯å—ï¼Ÿ</li><li>è¿™æ ·çš„å¼€é”€ä¼šä¸ä¼šéå¸¸å¤§ï¼Ÿ</li></ul><details class="hint-container details"><summary>&quot;å·¥ç¨‹å¸ˆçš„æ™ºæ…§&quot;</summary><ul><li>å°†æ¯ä¸ªæ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸Šçš„é” <strong>å…¨éƒ¨è®¤ä¸ºæ˜¯ä¸€ä¸ªé”</strong><ul><li>(å¾…è§£ç­”ï¼šä¸ºä»€ä¹ˆè¿™ä¹ˆåšæ˜¯å¯è¡Œçš„ï¼Œè€Œä¸ç”¨å»ç®¡å…·ä½“çš„çº¿ç¨‹ä¿¡æ¯? ğŸ˜µ ) <ul><li>ä¹Ÿè®¸ä¸ç”¨ç®¡å…·ä½“çš„è°ƒåº¦ï¼Ÿåªéœ€è¦æ˜ç¡®å­˜åœ¨ä¸€ä¸ªå¯èƒ½çš„è°ƒåº¦åºåˆ—èƒ½å¤Ÿäº§ç”Ÿæ­»é”å³å¯ï¼Ÿ</li></ul></li></ul></li></ul><figure><img src="`+p+'" alt="å°†æ¯ä¸ªæ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸Šçš„é”å…¨éƒ¨è®¤ä¸ºæ˜¯ä¸€ä¸ªé”" tabindex="0" loading="lazy"><figcaption>å°†æ¯ä¸ªæ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸Šçš„é”å…¨éƒ¨è®¤ä¸ºæ˜¯ä¸€ä¸ªé”</figcaption></figure><ul><li>ä»…åœ¨ <strong>ä¸Šé”ä¸”é”å›¾æ›´æ–°</strong> çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦æˆç¯</li></ul><figure><img src="'+d+'" alt="ä»…åœ¨ä¸Šé”ä¸”é”å›¾æ›´æ–°çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦æˆç¯" tabindex="0" loading="lazy"><figcaption>ä»…åœ¨ä¸Šé”ä¸”é”å›¾æ›´æ–°çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦æˆç¯</figcaption></figure></details></div><figure><img src="'+o+`" alt="å±±å¯¨è¿è¡Œæ—¶æ­»é”æ£€æŸ¥ç¨‹åº" tabindex="0" loading="lazy"><figcaption>æˆ‘ä»¬å±±å¯¨çš„è¿è¡Œæ—¶æ­»é”æ£€æŸ¥ç¨‹åºçš„æ‰§è¡Œç»“æœ</figcaption></figure><h3 id="è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥"><span>è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥</span></a></h3><p>å¯¹äºæ•°æ®ç«äº‰ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªæ˜ç¡®çš„ <strong>Specification</strong> :</p><blockquote><p>æ•°æ®ç«äº‰ï¼š<strong>ä¸åŒçš„çº¿ç¨‹</strong>åŒæ—¶è®¿é—®<strong>åŒä¸€å†…å­˜</strong>ï¼Œä¸”<strong>è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™</strong>ã€‚</p></blockquote><p>å³ä½¿æŸäº›çº¿ç¨‹çœ‹èµ·æ¥èƒ½å¤Ÿä¸å…¶ä½™çº¿ç¨‹é”™å¼€ï¼Œä½†æ˜¯æ•°æ®ç«äº‰æ˜¯ä»ç„¶å¯èƒ½å‘ç”Ÿçš„ â€”â€” è¿™å‡ ä¸ªçº¿ç¨‹ä¹‹é—´ä¸å­˜åœ¨ <em>happens before</em> å…³ç³»ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="çœ‹èµ·æ¥å­˜åœ¨ happens-before çš„ä»£ç " style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T_1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    spin_lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">A); </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    sum</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // &lt;-- data race occurs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    spin_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">A); </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T_2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() { </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> N; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        y</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    spin_lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">B); </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    sum</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // &lt;-- data race occurs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    spin_unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">B); </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› æ­¤æˆ‘ä»¬é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•æ¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ•°æ®ç«äº‰ï¼š</p>`,11)),i("div",C,[i("p",null,[s[35]||(s[35]=a("å¯¹äºå‘ç”Ÿåœ¨ä¸åŒçº¿ç¨‹ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™çš„ ")),i("mjx-container",H,[(t(),l("svg",M,s[31]||(s[31]=[n('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(572,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(1016.7,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g>',1)]))),s[32]||(s[32]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"x"),i("mo",null,","),i("mi",null,"y")])],-1))]),s[36]||(s[36]=a(" ï¼Œæ£€æŸ¥ ")),i("mjx-container",L,[(t(),l("svg",E,s[33]||(s[33]=[n('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="227A" d="M84 249Q84 262 91 266T117 270Q120 270 126 270T137 269Q388 273 512 333T653 512Q657 539 676 539Q685 538 689 532T694 520V515Q689 469 672 431T626 366T569 320T500 286T435 265T373 249Q379 248 404 242T440 233T477 221T533 199Q681 124 694 -17Q694 -41 674 -41Q658 -41 653 -17Q646 41 613 84T533 154T418 197T284 220T137 229H114Q104 229 98 230T88 235T84 249Z"></path></g><g data-mml-node="mi" transform="translate(1905.6,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(2617.8,0)"><path data-c="2228" d="M55 580Q56 587 61 592T75 598Q86 598 96 580L333 48L570 580Q579 596 586 597Q588 598 591 598Q609 598 611 580Q611 574 546 426T415 132T348 -15Q343 -22 333 -22T318 -15Q317 -14 252 131T121 425T55 580Z"></path></g><g data-mml-node="mi" transform="translate(3507,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4274.8,0)"><path data-c="227A" d="M84 249Q84 262 91 266T117 270Q120 270 126 270T137 269Q388 273 512 333T653 512Q657 539 676 539Q685 538 689 532T694 520V515Q689 469 672 431T626 366T569 320T500 286T435 265T373 249Q379 248 404 242T440 233T477 221T533 199Q681 124 694 -17Q694 -41 674 -41Q658 -41 653 -17Q646 41 613 84T533 154T418 197T284 220T137 229H114Q104 229 98 230T88 235T84 249Z"></path></g><g data-mml-node="mi" transform="translate(5330.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g>',1)]))),s[34]||(s[34]=i("mjx-assistive-mml",{unselectable:"on",display:"inline"},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"x"),i("mo",null,"â‰º"),i("mi",null,"y"),i("mo",null,"âˆ¨"),i("mi",null,"y"),i("mo",null,"â‰º"),i("mi",null,"x")])],-1))])])]),s[46]||(s[46]=n(`<blockquote><p>å¤§è‡´æ„æ€ï¼šåˆ©ç”¨ <em>acquire</em> / <em>release</em> æ‰€äº§ç”Ÿçš„ <em>happens before</em> å…³ç³»æ¥å½¢æˆå…·æœ‰ä¼ é€’å…³ç³»çš„å›¾ï¼Œåœ¨è¿™ä¸ªå›¾æ‰€è¡¨æ˜çš„å…ˆåå…³ç³»è¿™ä¸€çº¦æŸæ¡ä»¶ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°æ²¡æœ‰çº¦æŸçš„ä¸¤ä¸ªå†…å­˜è®¿é—®ï¼Œä¸”è¿™ä¸¤ä¸ªè®¿é—®å‘ç”Ÿåœ¨ä¸åŒçº¿ç¨‹ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™ï¼Œé‚£ä¹ˆç¨‹åºä¸­å­˜åœ¨ <em>data race</em>ã€‚</p><p><s>(è¿™ä¸ªå›¾ç”Ÿæˆçš„æˆ‘ä¸æ˜¯å¾ˆæ‡‚ï¼Œæ•…ç•¥è¿‡)</s></p></blockquote><h2 id="åº”å¯¹æ­»çº¿-â€”â€”-é˜²å¾¡æ€§ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#åº”å¯¹æ­»çº¿-â€”â€”-é˜²å¾¡æ€§ç¼–ç¨‹"><span>åº”å¯¹æ­»çº¿ â€”â€” é˜²å¾¡æ€§ç¼–ç¨‹</span></a></h2><p>ä½ å¯èƒ½å·²ç»è§è¯†è¿‡ä¸‹é¢è¿™äº› <em>Sanitizers</em> çš„å®åŠ›ï¼Œ<s>å¹¶ä¸”éå¸¸æƒ³æŠŠå®ƒæ¬åˆ°ä½ çš„æ“ä½œç³»ç»Ÿå®éªŒé‡Œé¢å»</s>ï¼š</p><ul><li>Address Sanitizer (<code>asan</code>) <ul><li>Buffer (heap/stack/global) overflow, use-after-free, use-after-return, double-free, ...;</li><li>æ²¡æœ‰ <a href="https://www.kernel.org/doc/html/latest/dev-tools/kasan.html" target="_blank" rel="noopener noreferrer">KASAN</a>, Linux Kernel çš„è´¨é‡/å®‰å…¨æ€§ç›´æ¥å´©ç›˜</li></ul></li><li>Thread Sanitizer (<code>tsan</code>): æ•°æ®ç«äº‰ <ul><li>KCSAN: <a href="https://lwn.net/Articles/816850/" target="_blank" rel="noopener noreferrer">Concurrency bugs should fear the big bad data-race detector</a></li></ul></li><li><a href="https://clang.llvm.org/docs/MemorySanitizer.html" target="_blank" rel="noopener noreferrer">Memory Sanitizer</a> (<code>msan</code>), <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html" target="_blank" rel="noopener noreferrer">UBSanitizer</a> (<code>ubsan</code>), ...</li></ul><p>å¾ˆä¸å¹¸ï¼Œç§»æ¤ä¸å¤ªå®¹æ˜“æˆåŠŸã€‚</p><p>é‚£æˆ‘ä»¬èƒ½ä¸èƒ½åšä¸€ä¸ªä¸ç‰ˆçš„å‘¢ï¼ŸğŸ¤”</p><ul><li>ä¸å®ç°å®Œæ•´çš„æ£€æŸ¥ï¼Œä½†æ˜¯å¯ä»¥å¸®æˆ‘ä»¬æ£€æŸ¥å‡ºå¤§éƒ¨åˆ†çš„é”™è¯¯</li><li><code>assertions</code> å°±æ˜¯ä¸€ä¸ªç®€å•æ–¹ä¾¿çš„é€‰æ‹©ï¼</li></ul><p>å½“ç„¶ï¼Œåœ¨çœ‹å®Œé‡‘ä¸é›€çš„æ•…äº‹ä¹‹å(è¿™é‡Œå°±ä¸æ”¾äº†ï¼Œæ„Ÿå…´è¶£çš„è¯è‡ªè¡Œå‰å¾€ <a href="https://jyywiki.cn/OS/2024/lect13.md" target="_blank" rel="noopener noreferrer">Lec13</a> æŸ¥çœ‹)ï¼Œä¹Ÿè®¸ä½ ä¼šè®¤ä¸º <strong>æ”¾ç½®å“¨å…µ</strong> è¿™ç§æ€è·¯ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><h3 id="é˜²å¾¡æ€§ç¼–ç¨‹-1-ä½é…ç‰ˆ-lockdep" tabindex="-1"><a class="header-anchor" href="#é˜²å¾¡æ€§ç¼–ç¨‹-1-ä½é…ç‰ˆ-lockdep"><span>é˜²å¾¡æ€§ç¼–ç¨‹(1): ä½é…ç‰ˆ <em>Lockdep</em></span></a></h3><p>æˆ‘ä»¬å¯ä»¥ä¸æ–­ç»Ÿè®¡è‡ªæ—‹çš„æ¬¡æ•°ï¼Œå¦‚æœæ¬¡æ•°è¾¾åˆ°äº†ä¸€ä¸ªå¾ˆé«˜çš„ä¸Šé™å€¼ <code>SPIN_LIMIT </code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠ›å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><p>ç»“åˆæ–­ç‚¹ä¸ <code>backtrace</code>ï¼Œä¹Ÿè®¸èƒ½å¤Ÿå¸®ä½ å¿«é€Ÿæ‰¾åˆ°æ­»é”çš„æºå¤´ã€‚</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="åœ¨å‡ ç§’ä¹‹å†…æ£€æŸ¥æ­»é”" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> spin_cnt </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xchg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">lk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> âŒ</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> âŒ) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (spin_cnt</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> &gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SPIN_LIMIT) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        panic</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Spin limit exceeded @ </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            __FILE__, __LINE__);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(gdb) b </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(gdb) bt</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é˜²å¾¡æ€§ç¼–ç¨‹-2-ä½é…ç‰ˆ-address-sanitizer" tabindex="-1"><a class="header-anchor" href="#é˜²å¾¡æ€§ç¼–ç¨‹-2-ä½é…ç‰ˆ-address-sanitizer"><span>é˜²å¾¡æ€§ç¼–ç¨‹(2): ä½é…ç‰ˆ <em>Address Sanitizer</em></span></a></h3><p>å°±æ‹¿ <a href="https://jyywiki.cn/OS/2024/labs/L1.md" target="_blank" rel="noopener noreferrer">L1</a> æ¥ä¸¾ä¾‹ï¼Œå¦‚ä½•æ£€æŸ¥è¯¸å¦‚ <em>double free</em> ã€ <em>double allocation</em> ç­‰é—®é¢˜å‘¢ï¼Ÿ</p><p>åˆå§‹æˆ‘ä»¬å¯ä»¥å°†æœªç”³è¯·è¿‡çš„åŒºåŸŸæ¶‚ä¸ŠæŸç§é¢œè‰²çš„æ¼†ï¼ŒæŠŠå·²ç»ç”³è¯·è¿‡çš„åŒºåŸŸç»Ÿä¸€ <strong>æ¶‚ä¸Šå¦ä¸€ç§é¢œè‰²çš„æ¼†</strong> (ä¸‹é¢ç»Ÿä¸€ç”¨ <code>MAGIC</code> è¡¨ç¤º)ï¼Œé‡Šæ”¾æ‰çš„åŒºåŸŸä¹ŸåŒç† (å‡è®¾æ¶‚ä¸Š <code>0</code> )ã€‚</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="ä½é…ç‰ˆ Address Sanitizer" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// allocation</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; (i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(u32) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> size; i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    panic_on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(((u32 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)ptr)[i] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAGIC, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;double-allocation&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[i] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MAGIC;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// free</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; (i </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> sizeof</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(u32) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&lt;=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> alloc_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ptr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // can also detect use-after-free</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    panic_on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(((u32 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)ptr)[i] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;double-free&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    arr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[i] </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é˜²å¾¡æ€§ç¼–ç¨‹-3-ä½é…ç‰ˆ-thread-sanitizer" tabindex="-1"><a class="header-anchor" href="#é˜²å¾¡æ€§ç¼–ç¨‹-3-ä½é…ç‰ˆ-thread-sanitizer"><span>é˜²å¾¡æ€§ç¼–ç¨‹(3)ï¼šä½é…ç‰ˆ Thread Sanitizer</span></a></h3><blockquote><p>æ•°æ®ç«äº‰å¹¶ä¸å¥½è¿›è¡Œè§‚æµ‹ â€”â€” å®ƒå¯èƒ½éœ€è¦å¾ˆä¹…ä»¥åæ‰ &quot;ç°å½¢&quot;ã€‚åŒæ—¶ï¼Œæƒ³è¦æŠ“åˆ°å…·ä½“çš„æºå¤´æ˜¯ä¸å®¹æ˜“çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä»…ä»…è¯•å›¾å»éªŒè¯æˆ‘ä»¬çš„ç¨‹åºä¸­æ˜¯å¦å­˜åœ¨æ•°æ®ç«äº‰ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å›é¡¾ä¸€ä¸‹æ•°æ®ç«äº‰äº§ç”Ÿçš„åŸå› ï¼š</p><ul><li><strong>ä¸åŒçš„çº¿ç¨‹</strong>åŒæ—¶è®¿é—®<strong>åŒä¸€å†…å­˜</strong>ï¼Œä¸”<strong>è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™</strong>ã€‚</li></ul><p><strong>å†™å…¥åŠ¿å¿…ä¼šé€ æˆçŠ¶æ€æœºçŠ¶æ€çš„æ”¹å˜</strong> ï¼Œå› æ­¤æˆ‘ä»¬æˆ–è®¸å¯ä»¥ä»è§‚æµ‹çŠ¶æ€æ”¹å˜å…¥æ‰‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯å½“å‰çº¿ç¨‹ä¸å¯¹å¾…è§‚å¯Ÿå†…å­˜è¿›è¡Œä¿®æ”¹çš„æƒ…å†µä¸‹ (å‡è®¾å½“å‰å¤„äºä¸Šé”ä¿æŠ¤çš„çŠ¶æ€)ï¼Œå¯¹æ•°æ®è¿›è¡Œä¸€å¯¹ <strong>&quot;æ—¶é—´è·¨åº¦è¾ƒå¤§&quot;</strong> çš„è§‚å¯Ÿï¼š</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="åœ¨è¾ƒå¤§æ—¶é—´è·¨åº¦ä¹‹åè§‚æµ‹çŠ¶æ€" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Suppose x is lock-protected</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> observe1 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">delay</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> observe2 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">observe1 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> observe2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸å­˜åœ¨æ•°æ®ç«äº‰ï¼Œé‚£ä¹ˆ <code>assertion</code> ä¸€å®šä¼šæˆç«‹ã€‚</p><p>(è¿™çœŸçš„æ˜¯ä¸€ä¸ªå¤©æ‰çš„æƒ³æ³•ï¼ç”šè‡³å†å¾€å‰èµ°è‹¥å¹²æ­¥ï¼Œå°±èƒ½å¾—åˆ° <a href="https://www.usenix.org/legacy/events/osdi10/tech/full_papers/Erickson.pdf" target="_blank" rel="noopener noreferrer">Effective data race detection for the Kernel</a> ï¼)</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>Bugs (åŒ…æ‹¬å¹¶å‘ bugs) ä¸€ç›´ä»¥æ¥å›°æ‰°ç€æ‰€æœ‰è½¯ä»¶å·¥ç¨‹çš„å®è·µè€…ã€‚æˆ‘ä»¬ä¸ä»…è¦åº”å¯¹ specification crisis (å®šä¹‰åˆ°åº•ä»€ä¹ˆæ˜¯å¯¹çš„)ï¼Œç”šè‡³å³ä¾¿çŸ¥é“ specificationï¼Œä¹Ÿéš¾ä»¥åº”å¯¹ç°ä»£è½¯ä»¶çš„å¤æ‚æ€§ã€‚ä¸ºäº†éƒ¨åˆ†åº”å¯¹è¿™ä¸€ç‚¹ä»è€Œå®ç° â€œæ›´æ­£ç¡®â€ çš„è½¯ä»¶ï¼Œæˆ‘ä»¬æŠŠå¯¹ç¨‹åºçš„é¢„æœŸè¡¨è¾¾åœ¨ç¨‹åºä¸­ (race-free, lock ordering, ...)ï¼Œè€Œä¸æ˜¯è®©ç¨‹åºåœ¨è‡ªç„¶çŠ¶æ€ä¸‹æ‚„æ‚„è¿›å…¥æœ‰é—®é¢˜çš„çŠ¶æ€ï¼Œå°±æ˜¯æˆ‘ä»¬ç›®å‰è§£å†³ç¨‹åºè°ƒè¯•é—®é¢˜çš„æŠ˜ä¸­åŠæ³•ã€‚â€œå±±å¯¨â€ sanitizer ç»™æˆ‘ä»¬å¸¦æ¥çš„å¯å‘åˆ™æ˜¯ï¼šå¦‚æœæˆ‘ä»¬èƒ½æ¸…æ¥šåœ°è¿½æº¯åˆ°é—®é¢˜äº§ç”Ÿçš„æœ¬æºï¼Œæˆ‘ä»¬å°±æ€»æ˜¯èƒ½æ‰¾åˆ°å¥½çš„åº”å¯¹æ–¹æ³•â€”â€”å±±å¯¨çš„ sanitizers åœ¨æš—ä¸­å¸®åŠ©ä½ å®ç° fail-fast çš„ç¨‹åºï¼Œä»è€Œå‡è½»ä½ è°ƒè¯•é—®é¢˜çš„è´Ÿæ‹…ã€‚å¸Œæœ›è¿™èŠ‚è¯¾èƒ½å¯å‘ã€å¸®åŠ©ä½ é‡æ–°æ€è€ƒ â€œç¼–ç¨‹â€ è¿™ä»¶äº‹ã€‚</p>`,27))])}const q=e(k,[["render",z],["__file","facing-concurrency-bugs.html.vue"]]),V=JSON.parse('{"path":"/zh/note/os/Concurrency/facing-concurrency-bugs.html","title":"åº”å¯¹å¹¶å‘ bugs","lang":"zh-CN","frontmatter":{"title":"åº”å¯¹å¹¶å‘ bugs","order":12,"icon":"bug-slash","categories":["æ“ä½œç³»ç»Ÿ"],"tags":["å¹¶å‘","å¸¸è§bugsåº”å¯¹"],"description":"èƒŒæ™¯å›é¡¾ï¼šæˆ‘ä»¬å·²ç»äº†è§£å¸¸è§çš„å¹¶å‘ bug ç±»å‹ï¼šæ­»é”ã€æ•°æ®ç«äº‰ã€åŸå­æ€§/é¡ºåºè¿åã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨ç¼–ç¨‹æ—¶æ¶ˆç­å¹¶å‘ bug ä»ç„¶æ˜¯ä¸€ä¸ªä¸–ç•Œæ€§çš„éš¾é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹è¿™äº›å¹¶å‘ bugsï¼Ÿ æœ¬è®²å†…å®¹ï¼šå¦ä¸€èŠ‚çœŸæ­£çš„å®ç”¨ â€œç¼–ç¨‹â€ è¯¾ â€”â€” å¦‚ä½•æ­£ç¡®åœ° (å¹¶å‘) ç¼–ç¨‹ï¼šåº”å¯¹ä¸‰ç§å¸¸è§çš„ â€œæ­»äº¡â€ æ–¹å¼ï¼š æ­»é” (deadlock) æ­»å±€ (è½¯ä»¶å±æœºä¸­çš„ dead...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/zh/note/os/Concurrency/facing-concurrency-bugs.html"}],["meta",{"property":"og:site_name","content":"æ–‡æ¡£æ¼”ç¤º"}],["meta",{"property":"og:title","content":"åº”å¯¹å¹¶å‘ bugs"}],["meta",{"property":"og:description","content":"èƒŒæ™¯å›é¡¾ï¼šæˆ‘ä»¬å·²ç»äº†è§£å¸¸è§çš„å¹¶å‘ bug ç±»å‹ï¼šæ­»é”ã€æ•°æ®ç«äº‰ã€åŸå­æ€§/é¡ºåºè¿åã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨ç¼–ç¨‹æ—¶æ¶ˆç­å¹¶å‘ bug ä»ç„¶æ˜¯ä¸€ä¸ªä¸–ç•Œæ€§çš„éš¾é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹è¿™äº›å¹¶å‘ bugsï¼Ÿ æœ¬è®²å†…å®¹ï¼šå¦ä¸€èŠ‚çœŸæ­£çš„å®ç”¨ â€œç¼–ç¨‹â€ è¯¾ â€”â€” å¦‚ä½•æ­£ç¡®åœ° (å¹¶å‘) ç¼–ç¨‹ï¼šåº”å¯¹ä¸‰ç§å¸¸è§çš„ â€œæ­»äº¡â€ æ–¹å¼ï¼š æ­»é” (deadlock) æ­»å±€ (è½¯ä»¶å±æœºä¸­çš„ dead..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-25T07:48:49.000Z"}],["meta",{"property":"article:tag","content":"å¹¶å‘"}],["meta",{"property":"article:tag","content":"å¸¸è§bugsåº”å¯¹"}],["meta",{"property":"article:modified_time","content":"2024-11-25T07:48:49.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"åº”å¯¹å¹¶å‘ bugs\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-25T07:48:49.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"codePJCP2\\",\\"url\\":\\"https://docs.pjcp2-personal.cn/zh/\\"}]}"]]},"headers":[{"level":2,"title":"åº”å¯¹æ­»é”","slug":"åº”å¯¹æ­»é”","link":"#åº”å¯¹æ­»é”","children":[]},{"level":2,"title":"åº”å¯¹æ­»å±€ â€”â€” ç»å¤„é€¢ç”Ÿ","slug":"åº”å¯¹æ­»å±€-â€”â€”-ç»å¤„é€¢ç”Ÿ","link":"#åº”å¯¹æ­»å±€-â€”â€”-ç»å¤„é€¢ç”Ÿ","children":[{"level":3,"title":"è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥","slug":"è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥","link":"#è¿è¡Œæ—¶çš„æ­»é”æ£€æŸ¥","children":[]},{"level":3,"title":"è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥","slug":"è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥","link":"#è¿è¡Œæ—¶çš„æ•°æ®ç«äº‰æ£€æŸ¥","children":[]}]},{"level":2,"title":"åº”å¯¹æ­»çº¿ â€”â€” é˜²å¾¡æ€§ç¼–ç¨‹","slug":"åº”å¯¹æ­»çº¿-â€”â€”-é˜²å¾¡æ€§ç¼–ç¨‹","link":"#åº”å¯¹æ­»çº¿-â€”â€”-é˜²å¾¡æ€§ç¼–ç¨‹","children":[{"level":3,"title":"é˜²å¾¡æ€§ç¼–ç¨‹(1): ä½é…ç‰ˆ Lockdep","slug":"é˜²å¾¡æ€§ç¼–ç¨‹-1-ä½é…ç‰ˆ-lockdep","link":"#é˜²å¾¡æ€§ç¼–ç¨‹-1-ä½é…ç‰ˆ-lockdep","children":[]},{"level":3,"title":"é˜²å¾¡æ€§ç¼–ç¨‹(2): ä½é…ç‰ˆ Address Sanitizer","slug":"é˜²å¾¡æ€§ç¼–ç¨‹-2-ä½é…ç‰ˆ-address-sanitizer","link":"#é˜²å¾¡æ€§ç¼–ç¨‹-2-ä½é…ç‰ˆ-address-sanitizer","children":[]},{"level":3,"title":"é˜²å¾¡æ€§ç¼–ç¨‹(3)ï¼šä½é…ç‰ˆ Thread Sanitizer","slug":"é˜²å¾¡æ€§ç¼–ç¨‹-3-ä½é…ç‰ˆ-thread-sanitizer","link":"#é˜²å¾¡æ€§ç¼–ç¨‹-3-ä½é…ç‰ˆ-thread-sanitizer","children":[]}]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}],"git":{"createdTime":1732520929000,"updatedTime":1732520929000,"contributors":[{"name":"codePJCP2","email":"159783914+codePJCP2@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":8.47,"words":2542},"filePathRelative":"zh/note/os/Concurrency/facing-concurrency-bugs.md","localizedDate":"2024å¹´11æœˆ25æ—¥","autoDesc":true}');export{q as comp,V as data};
