import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as i,b as a,e,f as t,o as h}from"./app-CySHXAx9.js";const p="/assets/1730356467740-7a6675d7-95b8-49d6-b23e-b7ffa827944a-598293-CcDGm7x3.jpeg",k="/assets/1730425742223-837a614e-c7cf-41e0-8e04-3f9e66f6f4bf-503423-C5XPThN7.jpeg",r="/assets/1730426249610-4b24830e-bde7-4baa-9c0f-dd5c16fa5231-225689-Bdg8c2jJ.png",d="/assets/1730426907196-3be3cdd2-668a-43bc-866f-932bac4adb2d-706862-BI93WNvG.png",A="/assets/1730427050137-69ebf097-1ecf-4d9b-8bd2-c29f04cd80e7-514268-DEEPRvro.png",c="/assets/1730430685935-13e52d3e-ecfd-471d-8371-eb741f6b9024-305907-Drz5w2AR.jpeg",g="/assets/1730437705076-29148737-d53f-41b1-bd81-92e939ac392a-153699-C83kBc6k.png",B="/assets/1730437839381-9b136d2f-827c-4678-806d-5f75cde287c5-663460-u5ZGrqoD.png",y={};function o(v,s){return h(),l("div",null,[s[0]||(s[0]=i("blockquote",null,[i("p",null,[i("strong",null,"ä¸ŠèŠ‚å›é¡¾"),a("ï¼šè™½ç„¶ â€œçº¿ç¨‹åº“â€ å…¥é—¨ç®€å•ï¼Œä½†å¤šå¤„ç†å™¨ã€ç¼–è¯‘ä¼˜åŒ–ã€ç¼“å­˜å’ŒåŠ¨æ€æµæ°´çº¿è¿«ä½¿æˆ‘ä»¬ â€œæ”¾å¼ƒâ€ è®¸å¤šé¡ºåºç¨‹åºç¼–ç¨‹æ—¶çš„åŸºæœ¬å‡è®¾ï¼Œç»™ç†è§£ã€ç¼–å†™å¹¶å‘ç¨‹åºå¸¦æ¥äº†å›°éš¾ã€‚")])],-1)),s[1]||(s[1]=i("p",null,[i("strong",null,"æœ¬è®²å†…å®¹"),a("ï¼šäººç±»ä»æ¥ä¸å®³æ€•å›°éš¾ã€‚æˆ‘ä»¬é€šè¿‡åˆ›é€ å‡ºæ–°çš„æ‰‹æ®µï¼Œå¸®åŠ©æˆ‘ä»¬ç¼–å†™æ­£ç¡®çš„å¹¶å‘ç¨‹åºï¼š")],-1)),s[2]||(s[2]=i("ul",null,[i("li",null,"äº’æ–¥é—®é¢˜å’Œ Peterson ç®—æ³•"),i("li",null,"åŸå­æŒ‡ä»¤å’Œè‡ªæ—‹é”")],-1)),e(" more -"),s[3]||(s[3]=t('<h2 id="å¹¶å‘æ§åˆ¶-é˜»æ­¢å¹¶å‘" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘æ§åˆ¶-é˜»æ­¢å¹¶å‘"><span>å¹¶å‘æ§åˆ¶ - é˜»æ­¢å¹¶å‘</span></a></h2><p>å¹¶å‘ç»™å¹¶å‘ç¨‹åºå¸¦æ¥äº†ä¸€ç³»åˆ—ä¸å®¹æ˜“è¢«æˆ‘ä»¬ç›´æ¥å¯Ÿè§‰çš„ bug (ä¾‹å¦‚æŸå±±å¯¨æ”¯ä»˜å®çš„é”™è¯¯æ‰£æ¬¾ä¾‹å­)ã€‚æˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å¯¹å¹¶å‘è¿›è¡Œæ§åˆ¶å‘¢ï¼Ÿ</p><p>ä¹Ÿè®¸ <strong>é˜»æ­¢å¹¶å‘</strong> æ˜¯å”¯ä¸€çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœ <strong>é˜»æ­¢å¹¶å‘</strong> æ˜¯å¯¹å¹¶å‘è¿›è¡Œæ­£ç¡®æ§åˆ¶çš„å”¯ä¸€æ–¹æ³•ï¼Œé‚£ä¹ˆå¹¶å‘ä¸ºä»€ä¹ˆè¦å­˜åœ¨ï¼Ÿ</p><figure><img src="'+p+'" alt="å…³äºå¹¶å‘çš„ä¸€äº›ç»“è®º" tabindex="0" loading="lazy"><figcaption>å…³äºå¹¶å‘çš„ä¸€äº›ç»“è®º</figcaption></figure><p>çœ‹èµ·æ¥ï¼Œå¹¶è¡Œæ€»å½’æ˜¯æœ‰ä½œç”¨çš„ï¼šåªè¦åœ¨ä¸éœ€è¦å¹¶å‘çš„æ—¶å€™é˜»æ­¢å¹¶å‘ï¼Œå…¶ä½™æƒ…å†µä¸‹å¯ç”¨å¹¶å‘ï¼Œå¹¶å‘æ€»èƒ½ç»™ç¨‹åºæ‰§è¡Œæé€Ÿã€‚</p><h2 id="å®ç°äº’æ–¥-stop-the-world" tabindex="-1"><a class="header-anchor" href="#å®ç°äº’æ–¥-stop-the-world"><span>å®ç°äº’æ–¥ - Stop the World</span></a></h2><figure><img src="'+k+'" alt="åŠ é”æ¥é˜»æ­¢å¹¶å‘" tabindex="0" loading="lazy"><figcaption>åŠ é”æ¥é˜»æ­¢å¹¶å‘</figcaption></figure><p>ä¸ºäº†å°½å¯èƒ½é¿å…å¹¶è¡Œå¸¦æ¥çš„ä¸€ç³»åˆ— bug ï¼Œæˆ‘ä»¬è¯•å›¾é€šè¿‡æ·»åŠ <strong>é”</strong>æ¥ä¿è¯æŒ‡å®šçŠ¶æ€è¿ç§»æ­¥éª¤çš„åŸå­æ€§ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“æŸä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶å€™ï¼Œå…¶ä»–çŠ¶æ€è¿ç§»ä¸èƒ½å¤Ÿå…¥ä¾µè¯¥çº¿ç¨‹çš„çŠ¶æ€è¿ç§»è¿‡ç¨‹ï¼Œä»¥æ­¤å®ç°æŒæœ‰é”è¿‡ç¨‹ä¸­çŠ¶æ€è¿ç§»çš„åŸå­æ€§ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®ç°äº’æ–¥å‘¢ï¼Ÿ</p><ul><li>å•å¤„ç†å™¨ç³»ç»Ÿï¼š<strong>å…³é—­ä¸­æ–­ (å‰¥å¤ºåˆ‡æ¢çŠ¶æ€æœºçš„èƒ½åŠ›)</strong></li><li>å¤šå¤„ç†å™¨ç³»ç»Ÿï¼š???</li></ul><figure><img src="'+r+'" alt="å•å¤„ç†å™¨å…³é—­ä¸­æ–­çš„æ–¹æ³•" tabindex="0" loading="lazy"><figcaption>å•å¤„ç†å™¨å…³é—­ä¸­æ–­çš„æ–¹æ³•</figcaption></figure><p>ç„¶è€Œï¼Œé“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆã€‚å¤„ç†å™¨ä¸­å­˜åœ¨ç€ <strong>NMI</strong> (<em>Non-Maskable Interrupts</em>ï¼Œä¸å¯å±è”½ä¸­æ–­)ï¼Œä¾‹å¦‚æ‰ç”µä¸­æ–­ç­‰æƒ…å†µã€‚<br> å…³ä¸­æ–­å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼š</p><ul><li><p><strong>æ“ä½œç³»ç»Ÿ</strong> å¯ä»¥ï¼Œä½†æ™®é€šç¨‹åºä¸è¡Œ</p><ul><li><p>ä¸­æ–­ä¿è¯äº†æ­»å¾ªç¯ä¸èƒ½æŠŠè®¡ç®—æœº â€œå¡æ­»â€</p></li><li><p>æ“ä½œç³»ç»Ÿä¸å…è®¸æ™®é€šç¨‹åºå…³ä¸­æ–­<br><img src="'+d+'" alt="ç”¨æˆ·æ€åº”ç”¨ç¨‹åºè¯•å›¾å…³ä¸­æ–­" title="ç”¨æˆ·æ€åº”ç”¨ç¨‹åºè¯•å›¾å…³ä¸­æ–­" loading="lazy"></p></li><li><p>ä½†å¦‚æœæ˜¯æ“ä½œç³»ç»Ÿä»£ç ï¼Œå®Œå…¨å¯ä»¥çŸ­æš‚å…³é—­ä¸­æ–­<br><img src="'+A+'" alt="åœ¨(è™šæ‹Ÿ)æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­å…³é—­ä¸­æ–­" title="åœ¨(è™šæ‹Ÿ)æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­å…³é—­ä¸­æ–­" loading="lazy"></p></li></ul></li><li><p><strong>å•å¤„ç†å™¨ç³»ç»Ÿ</strong> å¯ä»¥ï¼Œå¤šå¤„ç†å™¨ç³»ç»Ÿä¸è¡Œ</p><ul><li><p>æ¯ä¸ªå¤„ç†å™¨æœ‰ç‹¬ç«‹çš„å¯„å­˜å™¨ç»„</p></li><li><p>ä¸­æ–­æ˜¯<strong>æ¯ä¸ªå¤„ç†å™¨å†…éƒ¨çŠ¶æ€</strong></p></li></ul></li></ul><blockquote><p>å¯¹äºæ“ä½œç³»ç»Ÿä¸Šçš„åº”ç”¨ç¨‹åºï¼Œå…³é—­ä¸­æ–­æ˜¯<strong>ä¸èƒ½å®¹å¿</strong>çš„ï¼šè¿™ä¼šä½¿å¾®å°çš„ bug æˆ–æ˜¯æ¶æ„çš„ç¨‹åºç ´åè®¡ç®—æœºçš„è¿è¡Œã€‚æ“ä½œç³»ç»Ÿæ­£æ˜¯å› ä¸ºç»Ÿæ²»äº†ä¸­æ–­ï¼Œæ‰å®ç°äº†å¯¹åº”ç”¨ç¨‹åºçš„ç®¡ç†ã€‚åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„å®ç°ä¸­ï¼Œå…³é—­ä¸­æ–­æ˜¯ä¸€ä¸ªå¸¸è§çš„æ“ä½œã€‚</p></blockquote><h2 id="å®ç°äº’æ–¥-peterson-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å®ç°äº’æ–¥-peterson-ç®—æ³•"><span>å®ç°äº’æ–¥ - Peterson ç®—æ³•</span></a></h2><h3 id="dekker-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#dekker-ç®—æ³•"><span>Dekker ç®—æ³•</span></a></h3><blockquote><p>A process $ P $ can enter the critical section if <strong>the other does not want to enter</strong>, otherwise it may enter <strong>only if it is its turn</strong>.</p></blockquote><h3 id="peterson-ç®—æ³•-dekker-ç®—æ³•çš„æ”¹è¿›" tabindex="-1"><a class="header-anchor" href="#peterson-ç®—æ³•-dekker-ç®—æ³•çš„æ”¹è¿›"><span>Peterson ç®—æ³• - Dekker ç®—æ³•çš„æ”¹è¿›</span></a></h3><blockquote><p>A process $ P $ can enter the critical section if <strong>the other does not want to enter</strong>, or it has <strong>indicated its desire to enter (æ„å›¾)</strong> and has <strong>given the other process the turn (è®©æ­¥)</strong>.</p></blockquote><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure><img src="'+c+`" alt="äº‰ç”¨å•æ‰€" tabindex="0" loading="lazy"><figcaption>ç¤ºä¾‹ - äº‰ç”¨å•æ‰€</figcaption></figure><p>æ¥ç®€å•å½’çº³ä¸€ä¸‹æ¸¸æˆè§„åˆ™å§ï¼š</p><ul><li>å½“ä¸€ä¸ªçº¿ç¨‹æƒ³è¦è¿›å…¥ Critical Section æ—¶ï¼Œéœ€è¦å°†è‡ªå·±å¯¹åº”çš„<strong>æ——å­ä¸¾èµ·</strong>ï¼Œå¹¶ä¸”é¢„å…ˆå°†æ‰§è¡Œæƒé™åˆ†é…ç»™<strong>å…¶ä½™çº¿ç¨‹ä¸­çš„æŸä¸€ä¸ª</strong>(å³æ”¹å˜ turn çš„å€¼ä¸ºå¦ä¸€ä¸ªçº¿ç¨‹)ã€‚</li><li>åœ¨è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¸Šè¿°è®¾ç½®æ“ä½œåï¼Œè¯¥çº¿ç¨‹å°†ä¼šè¿›å…¥æŒç»­çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š <ul><li>è§‚å¯Ÿå…¶ä½™çº¿ç¨‹ä¸­æ˜¯å¦å­˜åœ¨ä¸¾æ——çš„çº¿ç¨‹ï¼Œå¦‚æœ<strong>æ²¡æœ‰</strong>åˆ™ç›´æ¥è¿›å…¥ Critical Section</li><li>å¦‚æœå­˜åœ¨ä¸¾æ——çº¿ç¨‹ï¼Œåˆ™è§‚å¯Ÿ turn å˜é‡çš„å€¼ (å¯ä»¥ç†è§£ä¸ºä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„çº¿ç¨‹)ï¼Œ<strong>å¦‚æœä¸ºè‡ªå·±</strong>åˆ™è¿›å…¥ Critical Sectionï¼Œå¦åˆ™ç»§ç»­ç­‰å¾…</li></ul></li><li>çº¿ç¨‹æ‰§è¡Œå®Œæˆ Critical Section åŒºåŸŸçš„ä»£ç åï¼Œéœ€è¦<strong>æ”¾ä¸‹</strong>è‡ªå·±çš„æ——å­</li></ul><p>å½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•è¿›å…¥ Critical Section æ—¶ï¼Œçº¿ç¨‹çš„æ‰‹å¿«ç¨‹åº¦ç›´æ¥å½±å“äº†å…¶ä½™çº¿ç¨‹è¢«ä¼˜å…ˆæ‰§è¡Œçš„æ¦‚ç‡ â€”â€” ä½ å†™å…¥çš„ turn å¾ˆæœ‰å¯èƒ½ä¼šè¢«åç»­å†™å…¥çš„çº¿ç¨‹è¦†ç›–ï¼Œä½†æ˜¯ä½ å†™å…¥çš„ turn å€¼æ˜¯<strong>å…¶ä½™çº¿ç¨‹</strong>ã€‚çœ‹èµ·æ¥ Peterson&#39;s Protocol æ˜¯ä¸€ä¸ªè°¦è®©åè®®ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒæ˜¯ä¸ª<strong>åˆ©å·±</strong>åè®®ã€‚</p><h3 id="peterson-s-algorithm-å®ç°" tabindex="-1"><a class="header-anchor" href="#peterson-s-algorithm-å®ç°"><span>Peterson&#39;s Algorithm - å®ç°</span></a></h3><div class="language-python line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="python" data-title="Implementation of peterson&#39;s algorithm" style="--vp-collapsed-lines:20;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;ğŸ´&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.turn </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â·&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            t </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.turn</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> y </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â¶&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                break</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.cs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â¶&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.cs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.cs.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">replace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;â¶&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;ğŸ&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.turn </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â¶&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            t </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.turn</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.x</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> t </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â·&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                break</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.cs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;â·&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.cs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> heap.cs.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">replace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;â·&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        heap.y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        sys_sched</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    heap.x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    heap.y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    heap.turn </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    heap.cs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">    sys_spawn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(T1)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">    sys_spawn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(T2)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>ä¸Šé¢çš„ä»£ç åœ¨æˆ‘ä»¬çš„ Model Checker ä¸Šæ‰§è¡Œçš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç°ä»£â€œç¼–è¯‘å™¨åŒ–â€çš„å¤„ç†å™¨ä¸Šæ‰§è¡Œï¼Œä¼šè¾“å‡ºæ­£ç¡®çš„ç»“æœå—ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ <strong>å¦å®š</strong> çš„ã€‚</p><p>æˆ‘ä»¬é‡æ–°ç”¨ C è¯­è¨€ç¼–å†™äº†ä¸€ä¸ª Peterson&#39;s Algorithm çš„å®ç°ï¼š</p><div class="language-c line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="c" data-title="Implementation of peterson&#39;s algorithm in C" style="--vp-collapsed-lines:20;--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;thread.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#define A 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> B</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// The caveat is: no matter how many times we run this test</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// without seeing it fail, we cannot be certain that we have</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// inserted sufficient barriers. Understanding the correctness</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// of this code is far beyond the scope of this course.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// #define BARRIER __sync_synchronize()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Peterson&#39;s algorithm is wrong without proper barriers:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">#define</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BARRIER</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">atomic_int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inside;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> count;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> critical_section</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // We expect this thread executing code exclusively,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // if the critical section is correctly implemented.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // assert(inside == 0);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // inside++</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        atomic_fetch_add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">inside, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // On some machines, printing a character will hide</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // the bug!</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // putchar(&#39;.&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    assert</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // assert(inside == 1);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // inside--</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        atomic_fetch_add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">inside, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> volatile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, b </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, turn;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T_A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                    BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        turn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> B;                 BARRIER;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // &lt;- this is critcal for x86</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">b) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;        BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (turn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> B) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // T_B can&#39;t execute critical_section now.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        critical_section</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                    BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> T_B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        b </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                    BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        turn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> A;                 BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">a) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;        BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (turn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> A) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // T_A can&#39;t execute critical_section now.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        critical_section</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        b </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;                    BARRIER;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(T_A);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(T_B);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>è¿è¡Œç»“æœï¼š</p><figure><img src="`+g+'" alt="æ‰§è¡Œå¤±è´¥ç¤ºä¾‹" tabindex="0" loading="lazy"><figcaption>æ‰§è¡Œå¤±è´¥ç¤ºä¾‹ - å±éšœå¤±æ•ˆ</figcaption></figure><p>æˆ‘ä»¬ç»™å®ƒé‡æ–°åŠ å› Barrier ä¹‹åï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><figure><img src="'+B+`" alt="ç¨‹åºä¼¼ä¹æ­£å¸¸è¿è¡Œäº†" tabindex="0" loading="lazy"><figcaption>ç¨‹åºä¼¼ä¹æ­£å¸¸è¿è¡Œäº†</figcaption></figure><p>è™½ç„¶åŠ äº† Barrier èƒ½å¤Ÿä½¿ç¨‹åºçš„è¡Œä¸ºå˜å¾—â€œçœ‹èµ·æ¥â€æ­£ç¡®ï¼Œä½†æ˜¯ä½ èƒ½ç¡®å®š<strong>å“ªäº›åœ°æ–¹çš„ barrier æ˜¯ä¸å¯å°‘çš„å—</strong>ï¼Ÿ<br> å› ä¸º Peterson ç®—æ³•åœ¨ç°ä»£å¤„ç†å™¨ä¸Šéœ€è¦æ·»åŠ è®¸å¤šå±éšœ(æˆ–è®¸æœ‰è®¸å¤šåœ°æ–¹å¯ä»¥ä¼˜åŒ–ï¼Œä½†æ˜¯ä½ åŸºæœ¬ä¸Šæ— æ³•ç¡®å®šå“ªäº›åœ°æ–¹çš„å±éšœæ˜¯å¿…ä¸å¯å°‘çš„)ï¼Œæ‰€ä»¥è¯¥ç®—æ³•åœ¨ç°åœ¨å·²ç»ä¸æ€ä¹ˆä½¿ç”¨äº†ã€‚</p><h2 id="å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥" tabindex="-1"><a class="header-anchor" href="#å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥"><span>å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥</span></a></h2><p>å®é™…ä¸Šï¼Œäº’æ–¥çš„æ ¹æœ¬ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ Critical Section æ“ä½œçš„<strong>åŸå­æ€§</strong>ã€‚</p><p>ä¸ºäº†åœ¨è½¯ä»¶æ–¹é¢å®ç°åŸå­è¿ç§»ï¼Œäººç±»æå‡ºäº† Dekker ç®—æ³•ã€Peterson ç®—æ³•...ç”šè‡³è¿˜éœ€è¦åŠ è£…è®¸å¤šä½ æ— æ³•å®Œå…¨ç¡®å®šå¦‚ä½•ä¼˜åŒ–çš„å±éšœæ¥ä¿è¯æ­£ç¡®æ€§...</p><p>ä½†æ˜¯ï¼Œåœ¨è®¡ç®—æœºä¸Šï¼Œè½¯ç¡¬ä»¶æ˜¯äº’è¡¥çš„ï¼Œå› æ­¤â€œ<strong>è½¯ä»¶ä¸å¤Ÿï¼Œç¡¬ä»¶æ¥å‡‘</strong>â€ã€‚</p><p>å¦‚æœè¦åœ¨ç¡¬ä»¶æ–¹é¢å®ç°äº’æ–¥ä»¥ä¿è¯ Critical Section æ“ä½œçš„åŸå­æ€§ï¼Œæˆ‘ä»¬ä¹Ÿè®¸å¯ä»¥å°å°çš„å€Ÿç”¨ä¸€ä¸‹ Stop the World çš„èƒ½åŠ› â€”â€” ä½¿ç”¨åŸå­æŒ‡ä»¤ã€‚</p><p>åŸå­æŒ‡ä»¤æä¾›äº†ä¸€å°æ®µæ—¶é—´çš„â€œStop the Worldâ€æ‰§è¡Œèƒ½åŠ›ï¼Œä¸ºçŠ¶æ€è¿ç§»çš„åŸå­æ€§åšäº†ä¿è¯ã€‚</p><ul><li>ä¸å¯æ‰“æ–­çš„ load + è®¡ç®— + store <ul><li>x86: Bus Lock; RISC-V: LR/SC (æ¥è‡ª MIPS) + atomic<br> æœ‰äº†åŸå­æŒ‡ä»¤ï¼Œæ€»ç®—å¯ä»¥åœ¨å¤šå¤„ç†å™¨ä¸Šå®ç° å¹¶è¡Œ 1 + 1 äº†ï¼</li></ul></li></ul><h3 id="åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”" tabindex="-1"><a class="header-anchor" href="#åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”"><span>åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”</span></a></h3><blockquote><p>è‡ªæ—‹é”ï¼š ç±»ä¼¼äºç”µå­çš„è‡ªæ—‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­ä¼šä¸€ç›´å°†è‡ªèº«çš„ status ä¸ âŒ äº¤æ¢ï¼Œå½¢æˆ âŒ - âŒ è‡ªæ—‹</p></blockquote><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="Implementation of spin lock using atomic instructions" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> status </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> âœ…;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¿™ä¸ªè¿›ç¨‹çŠ¶æ€æœºä¸­åªå­˜åœ¨ä¸€ä¸ªâœ…</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">retry:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> got </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> atomic_xchg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">status, âŒ);</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // åŸå­äº¤æ¢æŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ‰‹æ…¢çš„è¿›ç¨‹ä¼šä¸€ç›´åœ¨è¿™é‡Œâ€œè‡ªæ—‹â€</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (got </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">!=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> âœ…) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        goto</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> retry;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    atomic_xchg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">status, âœ…);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸€æ ¸è‡ªæ—‹ä¸­æ–­-å¤šæ ¸è‡ªæ—‹" tabindex="-1"><a class="header-anchor" href="#ä¸€æ ¸è‡ªæ—‹ä¸­æ–­-å¤šæ ¸è‡ªæ—‹"><span>ä¸€æ ¸è‡ªæ—‹ä¸­æ–­ï¼Œå¤šæ ¸è‡ªæ—‹ï¼Ÿ</span></a></h3><p>è§£å†³æ–¹æ¡ˆï¼šæ“ä½œç³»ç»ŸçŸ­æš‚å…³ä¸­æ–­</p>`,48))])}const m=n(y,[["render",o],["__file","mutex(1).html.vue"]]),b=JSON.parse(`{"path":"/zh/note/os/Concurrency/mutex(1).html","title":"å¹¶å‘æ§åˆ¶ï¼š äº’æ–¥(1)","lang":"zh-CN","frontmatter":{"title":"å¹¶å‘æ§åˆ¶ï¼š äº’æ–¥(1)","order":6,"icon":"ban","categories":["æ“ä½œç³»ç»Ÿ"],"tags":["å¹¶å‘","äº’æ–¥"],"description":"ä¸ŠèŠ‚å›é¡¾ï¼šè™½ç„¶ â€œçº¿ç¨‹åº“â€ å…¥é—¨ç®€å•ï¼Œä½†å¤šå¤„ç†å™¨ã€ç¼–è¯‘ä¼˜åŒ–ã€ç¼“å­˜å’ŒåŠ¨æ€æµæ°´çº¿è¿«ä½¿æˆ‘ä»¬ â€œæ”¾å¼ƒâ€ è®¸å¤šé¡ºåºç¨‹åºç¼–ç¨‹æ—¶çš„åŸºæœ¬å‡è®¾ï¼Œç»™ç†è§£ã€ç¼–å†™å¹¶å‘ç¨‹åºå¸¦æ¥äº†å›°éš¾ã€‚ æœ¬è®²å†…å®¹ï¼šäººç±»ä»æ¥ä¸å®³æ€•å›°éš¾ã€‚æˆ‘ä»¬é€šè¿‡åˆ›é€ å‡ºæ–°çš„æ‰‹æ®µï¼Œå¸®åŠ©æˆ‘ä»¬ç¼–å†™æ­£ç¡®çš„å¹¶å‘ç¨‹åºï¼š äº’æ–¥é—®é¢˜å’Œ Peterson ç®—æ³• åŸå­æŒ‡ä»¤å’Œè‡ªæ—‹é” å¹¶å‘æ§åˆ¶ - é˜»æ­¢å¹¶å‘ å¹¶å‘ç»™å¹¶å‘ç¨‹åºå¸¦æ¥äº†ä¸€ç³»åˆ—ä¸å®¹æ˜“...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/zh/note/os/Concurrency/mutex(1).html"}],["meta",{"property":"og:site_name","content":"æ–‡æ¡£æ¼”ç¤º"}],["meta",{"property":"og:title","content":"å¹¶å‘æ§åˆ¶ï¼š äº’æ–¥(1)"}],["meta",{"property":"og:description","content":"ä¸ŠèŠ‚å›é¡¾ï¼šè™½ç„¶ â€œçº¿ç¨‹åº“â€ å…¥é—¨ç®€å•ï¼Œä½†å¤šå¤„ç†å™¨ã€ç¼–è¯‘ä¼˜åŒ–ã€ç¼“å­˜å’ŒåŠ¨æ€æµæ°´çº¿è¿«ä½¿æˆ‘ä»¬ â€œæ”¾å¼ƒâ€ è®¸å¤šé¡ºåºç¨‹åºç¼–ç¨‹æ—¶çš„åŸºæœ¬å‡è®¾ï¼Œç»™ç†è§£ã€ç¼–å†™å¹¶å‘ç¨‹åºå¸¦æ¥äº†å›°éš¾ã€‚ æœ¬è®²å†…å®¹ï¼šäººç±»ä»æ¥ä¸å®³æ€•å›°éš¾ã€‚æˆ‘ä»¬é€šè¿‡åˆ›é€ å‡ºæ–°çš„æ‰‹æ®µï¼Œå¸®åŠ©æˆ‘ä»¬ç¼–å†™æ­£ç¡®çš„å¹¶å‘ç¨‹åºï¼š äº’æ–¥é—®é¢˜å’Œ Peterson ç®—æ³• åŸå­æŒ‡ä»¤å’Œè‡ªæ—‹é” å¹¶å‘æ§åˆ¶ - é˜»æ­¢å¹¶å‘ å¹¶å‘ç»™å¹¶å‘ç¨‹åºå¸¦æ¥äº†ä¸€ç³»åˆ—ä¸å®¹æ˜“..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-25T07:48:49.000Z"}],["meta",{"property":"article:tag","content":"å¹¶å‘"}],["meta",{"property":"article:tag","content":"äº’æ–¥"}],["meta",{"property":"article:modified_time","content":"2024-11-25T07:48:49.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"å¹¶å‘æ§åˆ¶ï¼š äº’æ–¥(1)\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-25T07:48:49.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"codePJCP2\\",\\"url\\":\\"https://docs.pjcp2-personal.cn/zh/\\"}]}"]]},"headers":[{"level":2,"title":"å¹¶å‘æ§åˆ¶ - é˜»æ­¢å¹¶å‘","slug":"å¹¶å‘æ§åˆ¶-é˜»æ­¢å¹¶å‘","link":"#å¹¶å‘æ§åˆ¶-é˜»æ­¢å¹¶å‘","children":[]},{"level":2,"title":"å®ç°äº’æ–¥ - Stop the World","slug":"å®ç°äº’æ–¥-stop-the-world","link":"#å®ç°äº’æ–¥-stop-the-world","children":[]},{"level":2,"title":"å®ç°äº’æ–¥ - Peterson ç®—æ³•","slug":"å®ç°äº’æ–¥-peterson-ç®—æ³•","link":"#å®ç°äº’æ–¥-peterson-ç®—æ³•","children":[{"level":3,"title":"Dekker ç®—æ³•","slug":"dekker-ç®—æ³•","link":"#dekker-ç®—æ³•","children":[]},{"level":3,"title":"Peterson ç®—æ³• - Dekker ç®—æ³•çš„æ”¹è¿›","slug":"peterson-ç®—æ³•-dekker-ç®—æ³•çš„æ”¹è¿›","link":"#peterson-ç®—æ³•-dekker-ç®—æ³•çš„æ”¹è¿›","children":[]},{"level":3,"title":"Peterson's Algorithm - å®ç°","slug":"peterson-s-algorithm-å®ç°","link":"#peterson-s-algorithm-å®ç°","children":[]}]},{"level":2,"title":"å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥","slug":"å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥","link":"#å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„äº’æ–¥","children":[{"level":3,"title":"åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”","slug":"åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”","link":"#åŸå­æŒ‡ä»¤å®ç°è‡ªæ—‹é”","children":[]},{"level":3,"title":"ä¸€æ ¸è‡ªæ—‹ä¸­æ–­ï¼Œå¤šæ ¸è‡ªæ—‹ï¼Ÿ","slug":"ä¸€æ ¸è‡ªæ—‹ä¸­æ–­-å¤šæ ¸è‡ªæ—‹","link":"#ä¸€æ ¸è‡ªæ—‹ä¸­æ–­-å¤šæ ¸è‡ªæ—‹","children":[]}]}],"git":{"createdTime":1730811060000,"updatedTime":1732520929000,"contributors":[{"name":"codePJCP2","email":"159783914+codePJCP2@users.noreply.github.com","commits":4}]},"readingTime":{"minutes":7.12,"words":2136},"filePathRelative":"zh/note/os/Concurrency/mutex(1).md","localizedDate":"2024å¹´11æœˆ5æ—¥","autoDesc":true}`);export{m as comp,b as data};
